import*as chatModel from"../models/chatModel.js";export const sendPesan=async(req,res)=>{const{penerima_id:penerima_id,pesan:pesan}=req.body,pengirim_id=req.user.id;console.log(req.body);try{const idPesan=await chatModel.addChat(pengirim_id,penerima_id,pesan);res.status(200).json({message:"Pesan berhasil dikirim",pesan_id:idPesan})}catch(error){console.error("Error sending message:",error),res.status(500).json({message:"Gagal mengirim pesan",error:error.message})}};export const getPesan=async(req,res)=>{const{penerima_id:penerima_id}=req.params,pengirim_id=req.user.id;try{const pesan=await chatModel.getChatByPengirimPenerima(pengirim_id,penerima_id);if(console.log("Messages fetched:",pesan),0===pesan.length)return res.status(404).json({message:"Tidak ada pesan"});res.status(200).json(pesan)}catch(error){console.error("Error fetching messages:",error),res.status(500).json({message:"Gagal mengambil pesan",error:error.message})}};export const deletePesan=async(req,res)=>{const{id:id}=req.params,pengguna_id=req.user.id;try{const pesan=await chatModel.getChatById(id);if(!pesan)return res.status(404).json({message:"Pesan tidak ditemukan"});if(pesan.pengirim_id!==pengguna_id)return res.status(403).json({message:"Anda tidak memiliki hak untuk menghapus pesan ini"});if(!await chatModel.deleteChat(id))return res.status(400).json({message:"Gagal menghapus pesan"});res.status(200).json({message:"Pesan berhasil dihapus"})}catch(error){console.error("Error deleting message:",error),res.status(500).json({message:"Gagal menghapus pesan",error:error.message})}};export const getInteractedUsers=async(req,res)=>{const userId=req.user.id;try{const users=await chatModel.getInteractedUsers(userId);res.status(200).json(users)}catch(error){console.error("Error fetching interacted users:",error),res.status(500).json({message:"Gagal mengambil daftar pengguna",error:error.message})}};